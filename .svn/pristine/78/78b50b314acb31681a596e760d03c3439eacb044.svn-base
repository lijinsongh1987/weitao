<?php
class GoodsCenterAction extends BaseAction {
	public function goodsmanager(){
		import("ORG.Util.Page");
		if($_GET['gid']){
			$and .=" and a.gid = '".$_GET['gid']."'";
		}
		if($_GET['starttime']){
			$starttime= $_GET['starttime'];
			$and .= " and a.update_time >= '".$starttime." 00:00:00'";
		}
		if($_GET['endtime']){
			$endtime= $_GET['endtime'];
			$and .= " and a.update_time <= '".$endtime." 23:59:59'";
		}
		if($_GET['pricegt']){
			$and .=" and a.Price >= ".$_GET['pricegt'];
		}
		if($_GET['pricelt']){
			$and .=" and a.Price <= ".$_GET['pricelt'];
		}
		if ($_GET['shaixuanid']) {
			if ($_GET['type']) {
				$and .= " and a.Cid = ".$_GET['type'];
			}
			if ($_GET['status']) {
				$status = $_GET['status'] - 1;
				$and .= " and a.tuijianstatus = ".$_GET['status'];
			}
			if($_GET['yuanpricegt']){
				$and .=" and a.Org_Price >= ".$_GET['yuanpricegt'];
			}
			if($_GET['yuanpricelt']){
				$and .=" and a.Org_Price <= ".$_GET['yuanpricelt'];
			}
			if($_GET['salergt']){
				$and .=" and a.Sales_num >= ".$_GET['salergt'];
			}
			if($_GET['salerlt']){
				$and .=" and a.Sales_num <= ".$_GET['salerlt'];
			}
		}
		$totalRows = M()->table("wt_goods a,wt_goodstype b")->where("a.Cid = b.tkid ".$and)->count();
		$page= new Page($totalRows,20);
		$this->list=M()->table("wt_goods a,wt_goodstype b")->where("a.Cid = b.tkid ".$and)->limit($page->firstRow,$page->listRows)->order("update_time desc")->field("a.*,b.typename")->select();
		$this->page= $page->show();
		$this->shaixuanid = $_GET['shaixuanid'];
		$this->typelist = M("goodstype")->select();
		$this->display();
	}
	
	public function tuijiantrue(){
		$data['id'] = $_POST['id'];
		$data['status'] = $_POST['status'];
		if ($_POST['status'] == 1) {
			$data['xiajiatime'] = date("Y-m-d H:i:s");
		} else {
			$data['xiajiatime'] = date("Y-m-d H:i:s");
		}
		$is = M("goods")->save($data);
		if ($is) {
			$data2['msg'] = 1;
		} else {
			$data2['msg'] = 0;
		}
		echo json_encode($data2);
	}
	
	public function batheditgoods(){
		$ids = $_POST['ids'];
		$data['status'] = $_POST['status'];
		if ($_POST['status'] == 1) {
			$data['xiajiatime'] = date("Y-m-d H:i:s");
		} else {
			$data['xiajiatime'] = date("Y-m-d H:i:s");
		}
		$is = M("goods")->where("id in (".$ids.")")->save($data);
		if ($is) {
			$data2['msg'] = 1;
		} else {
			$data2['msg'] = 0;
		}
		echo json_encode($data2);
	}
	
	public function updategoodsinfo(){
		$data['id'] = $_POST['id'];
		$data['D_title'] = $_POST['dtitle'];
		$data['Pic'] = $_POST['pic'];
		$data['Cid'] = $_POST['typeid'];
		$data['Org_Price'] = $_POST['orgprice'];
		$data['Sales_num'] = $_POST['salesnum'];
		$data['SellerID'] = $_POST['sellerid'];
		$data['isTmall'] = $_POST['isTmall'];
		$data['status'] = $_POST['saleFlag'];
		$data['Quan_id'] = $_POST['quanid'];
		$data['Quan_price'] = $_POST['quanprice'];
		$data['Commission_jihua'] = $_POST['Commission_jihua'];
		$data['Commission_queqiao'] = $_POST['Commission_queqiao'];
		$is = M("goods")->save($data);
		if ($is) {
			$data2['msg'] = 1;
		} else {
			$data2['msg'] = 0;
		}
// 		$data2['sql'] = M()->getLastSql();
		echo json_encode($data2);
	}
}
?>