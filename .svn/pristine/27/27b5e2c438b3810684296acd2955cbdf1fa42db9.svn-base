<?php
class GoodsCenterAction extends BaseAction {
	public function goodsmanager(){
		import("ORG.Util.Page");
		if($_GET['goodsid']){
			$and .=" and gid = '".$_GET['goodsid']."'";
		}
		if($_GET['starttime']){
			$starttime= $_GET['starttime'];
			$and .= " and update_time >= '".$starttime." 00:00:00'";
		}
		if($_GET['endtime']){
			$endtime= $_GET['endtime'];
			$and .= " and update_time <= '".$endtime." 23:59:59'";
		}
		if($_GET['pricegt']){
			$and .=" and Price >= ".$_GET['pricegt'];
		}
		if($_GET['pricelt']){
			$and .=" and Price <= ".$_GET['pricelt'];
		}
		if ($_GET['shaixuanid']) {
			if ($_GET['type']) {
				$and .= " and Cid = ".$_GET['type'];
			}
			if ($_GET['status']) {
				$status = $_GET['status'] - 1;
				$and .= " and tuijianstatus = ".$_GET['status'];
			}
			if($_GET['yuanpricegt']){
				$and .=" and Org_Price >= ".$_GET['yuanpricegt'];
			}
			if($_GET['yuanpricelt']){
				$and .=" and Org_Price <= ".$_GET['yuanpricelt'];
			}
			if($_GET['salergt']){
				$and .=" and Sales_num >= ".$_GET['salergt'];
			}
			if($_GET['salerlt']){
				$and .=" and Sales_num <= ".$_GET['salerlt'];
			}
		}
		$totalRows = M("goods")->where("id is not null ".$and)->count();
		$page= new Page($totalRows,20);
		$this->list=M("goods")->where("id is not null ".$and)->limit($page->firstRow,$page->listRows)->order("update_time desc")->select();
		$this->page= $page->show();
		$this->shaixuanid = $_GET['shaixuanid'];
		$this->typelist = M("goodstype")->select();
		$this->display();
	}
	
	public function tuijiantrue(){
		$data['id'] = $_POST['id'];
		$data['tuijianstatus'] = 1;
		$is = M("goods")->save($data);
		if ($is) {
			$data2['msg'] = 1;
		} else {
			$data2['msg'] = 0;
		}
		echo json_encode;
	}
	
	public function tuijiancannel(){
		$data['id'] = $_POST['id'];
		$data['tuijianstatus'] = 0;
		$is = M("goods")->save($data);
		if ($is) {
			$data2['msg'] = 1;
		} else {
			$data2['msg'] = 0;
		}
		echo json_encode;
	}
}
?>