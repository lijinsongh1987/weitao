<?php

class PersnoalAction extends Action{
    public function persnoal(){
        $this->display();       
    }
   
    //提现页面
    public function withdraw(){
        $this->display();
    }
    
    public function message(){
        $this->display();
    }
    
    public function invite(){
        $this->display();
    }
    
    public function calssroom(){
        $this->display();
    }
    
    public function setup(){
        $this->display();
    }
    
    public function recording(){
        $this->display();
    }
    
    public function coupon(){
        $openid = 'o6vyL0_DwhNtOsO7OVMMjO1pkEaE';
        $dates = strtotime(date("Y-m-d"));
        $list=M()->table("wt_redbag a,wt_redtype b")->where("a.openid = '".$openid."' and a.tid = b.id")->field("a.id as redid,a.*,b.*")->select();
        for($i = 0;$i < count($list);$i++){
            if(!strtotime($list[$i]['faildate']) == 0){
                if($dates > strtotime($list[$i]['faildate'])){
                    $list[$i]['shixiao'] = 1;
                }else{
                    $list[$i]['shixiao'] = 0;
                }
                
            }else{
                $list[$i]['shixiao'] = 0;
            }
            
        }
        $this->list = $list;
        $this->display();
    }
    
    public function proxy(){
        $this->display();
    }
    
    public function fillIn(){
        $this->display();
    }
    
    public function getyue(){
    	$openid = $_POST['openid'];
    	//��ȡ���
    	$yue = M("yue")->where("openid = '".$openid."'")->select();
    	//��������
    	$fen = M("yuesource")->where("openid = '".$openid."' and status = 1")->field("sum(price) as price")->group("openid")->select();
    	//��������
    	$yao = M("yuesource")->where("openid = '".$openid."' and status = 0")->field("sum(price) as price")->group("openid")->select();
    	//�������
    	$red = M("yuesource")->where("openid = '".$openid."' and status = 2")->field("sum(price) as price")->group("openid")->select();
    	if ($yue){
    		$data['yue'] = $yue[0]['yue'];
    	} else {
    		$data['yue'] = 0;
    	}
    	if ($fen){
    		$data['fen'] = $fen[0]['price'];
    	} else {
    		$data['fen'] = 0;
    	}
    	if ($yao){
    		$data['yao'] = $yao[0]['price'];
    	} else {
    		$data['yao'] = 0;
    	}
    	if ($red){
    		$data['red'] = $red[0]['price'];
    	} else {
    		$data['red'] = 0;
    	}
    	echo json_encode($data);
    }
    
    public function getyueinfo(){
    	//查询余额
    	$data = M("yue")->where("openid = '".$_POST['openid']."'")->select();
    	echo json_encode($data);
    }
    
    public function addtixian(){
    	$data['openid'] = $_POST['openid'];
    	$data['tixian'] = $_POST['tixian'];
    	$data['alipay'] = $_POST['alipay'];
    	$data['realname'] = $_POST['realname'];
    	$data['time'] = date("Y-m-d H:i:s");
    	$data['status'] = 0;
    	$is = M("tixian")->add($data);
    	//余额减去提现金额
    	$yuelist = M("yue")->where("openid = '".$_POST['openid']."'")->select();
    	$data3['yue'] = $yuelist[0]['yue'] - $_POST['tixian'];
    	$data3['id'] = $yuelist[0]['id'];
    	$is = M("yue")->save($data3);
    	if ($is) {
    		$data2['msg'] = 1;
    	} else {
    		$data2['msg'] = 0;
    	}
    	echo json_encode($data2);
    }
    
    public function getpayrecord(){
    	$conter = $_POST['counter'];
    	$conter = $conter*20;
    	$openid = $_POST['openid'];
    	$data = M('tixian')->where("openid = '".$_POST['openid']."'")->limit($conter,20)->select();
//     	$data['sql'] = M()->getLastSql();
    	echo json_encode($data);
    }
}

?>