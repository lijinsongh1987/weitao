<?php
class RedBagSetupAction extends BaseAction {
	public function redbagtype(){
		$and = "";
		if ($_GET['typename']) {
			$and .= " and typename = '".$_GET['typename']."'";
		}
		import("ORG.Util.Page");
		$totalRows=M("redtype")->where("id is not null ".$and)->count();
		$page= new Page($totalRows,20);
		$this->list = M("redtype")->where("id is not null ".$and)->limit($page->firstRow,$page->listRows)->order("id desc")->select();
		$this->page= $page->show();
		$this->display();
	}
	
	public function editredbagtype(){
		if ($_POST['id']){
			$data['id'] = $_POST['id'];
			$data['condition'] = $_POST['condition'];
			$data['typename'] = $_POST['typename'];
			$data['price'] = $_POST['price'];
			$data['failtime'] = $_POST['failtime'];
			$is = M("redtype")->save($data);
			if ($is) {
				$data2['msg'] = 1;
			} else {
				$data2['msg'] = 0;
			}
		} else {
			$data['condition'] = $_POST['condition'];
			$data['typename'] = $_POST['typename'];
			$data['price'] = $_POST['price'];
			$data['failtime'] = $_POST['failtime'];
			$data['createtime'] = date("Y-m-d H:i:s");
			$is = M("redtype")->add($data);
			if ($is) {
				$data2['msg'] = 1;
			} else {
				$data2['msg'] = 0;
			}
		}
		echo json_encode($data2);
	}
}
?>