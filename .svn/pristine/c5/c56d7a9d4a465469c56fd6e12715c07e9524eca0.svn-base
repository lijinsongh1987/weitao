<?php if (!defined('THINK_PATH')) exit();?><!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>订单状态查询</title>
<link rel="stylesheet" type="text/css" href="./Public/Home/css/common.css" />
<link rel="stylesheet" type="text/css" href="./Public/Home/css/order.css" />
<script type="text/javascript" src="./Public/Home/js/jquery.min.js"></script>
<script type="text/javascript" src="./Public/Home/js/flexible.js"></script>
<script type="text/javascript" src="./Public/Home/layer/layer.js"></script>
<style>

#codesubmit:hover{
	text-decoration:none;
	outline:none
}
</style>
</head>

<body>
	<div id="bigbox">
   		<!-- 缺省页-->
    	<div class="defaultpage" style="display:none">
    		<img src="./Public/Home/images/noneorder.png">
            <p>暂时还没有订单哦！</p>
    	</div>
    	
        <?php if(is_array($orderlist)): $i = 0; $__LIST__ = $orderlist;if( count($__LIST__)==0 ) : echo "" ;else: foreach($__LIST__ as $key=>$vo): $mod = ($i % 2 );++$i;?><div class="list">
	            <div class="listbox">
	                <img class="goodsimg" src="<?php echo ($vo["thumbnails"]); ?>">
	                <div class="goodstext">
	                    <div class="title">
	                        <h4><?php echo ($vo["goodsname"]); ?></h4>
	                        <h6>￥<?php echo ($vo["goodsprice"]); ?></h6>
	                    </div>
	                    <p class="status">
		                    <?php if($vo["state"] == 1): ?><span style="color:#646464">订单待审核</span><?php endif; ?>
					       	<?php if($vo["state"] == 2): ?><span>审核已通过</span><?php endif; ?>
					       	<?php if($vo["state"] == 3): ?><span style="color:#ff331e">审核不通过，订单不存在</span><?php endif; ?>
					       	<?php if($vo["state"] == 4): ?><span style="color:#ff331e; ">订单已完成</span><?php endif; ?>
						</p>
	                </div>
	            </div>
	            
	            <?php if($vo["state"] == 2): ?><div class="order_button">
		            	<?php if($vo["whether"] == 1): if($vo["redeemsatus"] == 0): ?><a href="#" class="receipt" onclick="openpop('<?php echo ($vo["dateid"]); ?>')">填写兑换码</a><?php endif; endif; ?>
		            	<?php if($vo["redeemsatus"] == 0): if($vo["whether"] == 1): ?><a href="#" class="receipt" onclick="openpop1('<?php echo ($vo["dateid"]); ?>')">积分兑换</a><?php endif; endif; ?>
		                <a href="?s=Order/logistics/id/<?php echo ($vo["dateid"]); ?>" class="logistics">查看物流</a>
		                  
		            </div><?php endif; ?>
	        </div><?php endforeach; endif; else: echo "" ;endif; ?>
    </div>
    
    
    <div class="popbox" id="pop">
    	<div class="pop">
        	<img class="displayimg" src="./Public/Home/images/failure.png">
            <input type="text" id="code" name="code" placeholder="填写您的兑换码"/>
            <a class="no" id="codesubmit">提交</a>
            <button class="cancel" id="cancel" type="button">取消</button>
        </div>
    </div>
    
    <div class="popbox" id="pop01">
    	<div class="pop">
        	<p>本次兑换消耗<strong id="integral" style="color:#f82e54"></strong>积分</p>
            <a class="no" id="redeemsatussubmit">提交</a>
            <button class="cancel" id="cancels" type="button">取消</button>
        </div>
    </div>
</body>

<script>
function openpop(dateid){
	$("#pop").fadeIn(500);
	$("#codesubmit").click(function(){
		$dateid = dateid;
		$code = $("#code").val();
		if($code !== ""){
			$.ajax({
				type:"post",
				url:"?s=Order/codejudgment",
				data:{dateid:$dateid,code:$code},
				dataType : "json",			
				success : function(data){
					//layer.msg(data['msg'],{time:20000});
					//alert(data['msg']);
					if(data['msg'] == 0){
						layer.msg('提交成功',{time:1000},function(){
							window.location.reload();
						}); 
					}else if(data['msg'] == 1){
						layer.msg('该兑换码已使用'); 
					}else if(data['msg'] == 2){
						layer.msg('该兑换码不存在'); 
					}
				}
			});
		}else{
			layer.msg('请填写您的兑换码');
		}
		})
}

function openpop1(dateid){
	$("#pop01").fadeIn(500);
	$dateid = dateid;
	$.ajax({
		type:"post",
		url:"?s=Order/goodsintegrallist",
		data:{dateid:$dateid},
		dataType : "json",			
		success : function(data){
			if(data){
				$("#integral").html(data['msg']);
			}
		}
	});
	$("#redeemsatussubmit").click(function(){
		$dateid = dateid;
		$.ajax({
			type:"post",
			url:"?s=Order/redeemsatusjudgment",
			data:{dateid:$dateid},
			dataType : "json",			
			success : function(data){
				//alert($dateid);
				//alert(data['msg']);
				if(data['msg'] == 0){
					layer.msg('兑换成功',{time:1000},function(){
						window.location.reload();
					}); 
				}else if(data['msg'] == 1 || data['msg'] == 2){
					layer.msg('兑换失败');
				}else if(data['msg'] == 3){
					layer.msg('您的积分不够',{time:1000},function(){
						window.location.reload();
					}); 
				}
			}
		});
	})
}

$(function(){
	/* $(".receipt").click(function(){
		$(".popbox").fadeIn(500);
		}); */
	$("#cancel").click(function(){
		$(".popbox").fadeOut(500);
		});
	$("#cancels").click(function(){
		$(".popbox").fadeOut(500);
		});
	
	
	})
</script>
</html>